# Test Design: Story 2.1

**Date**: 2025-09-01  
**Designer**: Quinn (Test Architect)  
**Story**: Basic CLI Framework and Command Execution

## Test Strategy Overview

- **Total test scenarios**: 15
- **Unit tests**: 9 (60%)
- **Integration tests**: 4 (27%)  
- **E2E tests**: 2 (13%)
- **Priority distribution**: P0: 7, P1: 6, P2: 2

## Test Scenarios by Acceptance Criteria

### AC1: Click-based CLI application with main group command `promptcraft`

| ID           | Level       | Priority | Test                           | Justification                    |
| ------------ | ----------- | -------- | ------------------------------ | -------------------------------- |
| 2.1-UNIT-001 | Unit        | P0       | CLI group creation and structure | Click framework setup validation |
| 2.1-INT-001  | Integration | P0       | CLI entry point functionality    | Full command execution path      |

### AC2: Primary command accepts format: `promptcraft /command-name arg1 arg2 argN`

| ID           | Level | Priority | Test                            | Justification               |
| ------------ | ----- | -------- | ------------------------------- | --------------------------- |
| 2.1-UNIT-002 | Unit  | P0       | Argument parsing validation     | Critical input processing   |
| 2.1-UNIT-003 | Unit  | P0       | Multiple arguments handling     | Core argument logic         |
| 2.1-UNIT-004 | Unit  | P1       | Edge cases - empty arguments   | Error prevention            |
| 2.1-UNIT-005 | Unit  | P1       | Special characters in arguments | Input robustness            |

### AC3: Command strips leading slash from command name before processing  

| ID           | Level | Priority | Test                         | Justification                    |
| ------------ | ----- | -------- | ---------------------------- | -------------------------------- |
| 2.1-UNIT-006 | Unit  | P1       | Slash stripping logic        | Input transformation validation  |
| 2.1-UNIT-007 | Unit  | P1       | Commands without slash       | Handle both input formats        |

### AC4: Successfully processed prompts copied to clipboard using pyperclip

| ID           | Level       | Priority | Test                              | Justification                     |
| ------------ | ----------- | -------- | --------------------------------- | --------------------------------- |
| 2.1-INT-002  | Integration | P0       | Clipboard copy success path       | Core functionality verification   |
| 2.1-INT-003  | Integration | P0       | Clipboard failure fallback        | Risk mitigation (TECH-002)        |
| 2.1-INT-004  | Integration | P1       | Integration with process_command  | Core pipeline connection          |

### AC5: Success message displayed: "✅ Prompt for '/command-name' copied to clipboard!"

| ID           | Level | Priority | Test                          | Justification           |
| ------------ | ----- | -------- | ----------------------------- | ----------------------- |
| 2.1-UNIT-008 | Unit  | P1       | Success message format        | User feedback accuracy  |
| 2.1-UNIT-009 | Unit  | P1       | Message with command context  | Dynamic content display |

### AC6: Green color coding used for success messages using click.secho

| ID           | Level | Priority | Test                       | Justification      |
| ------------ | ----- | -------- | -------------------------- | ------------------ |
| 2.1-UNIT-010 | Unit  | P2       | Color formatting validation | Visual feedback    |

### AC7: CLI includes proper help text and usage examples

| ID          | Level | Priority | Test                    | Justification           |
| ----------- | ----- | -------- | ----------------------- | ----------------------- |
| 2.1-UNIT-011| Unit  | P1       | Help text content       | User guidance accuracy  |
| 2.1-E2E-001 | E2E   | P1       | Help command execution  | User journey validation |

## Risk Coverage Mapping

Mapeamento dos cenários de teste para riscos identificados:

- **TECH-002 (Clipboard failure)**: 2.1-INT-003 (fallback testing)
- **TECH-001 (CLI-Core integration)**: 2.1-INT-004 (integration testing)  
- **PERF-001 (Performance <150ms)**: 2.1-E2E-002 (performance validation)
- **SEC-001 (Input validation)**: 2.1-UNIT-004, 2.1-UNIT-005 (edge cases)

## Additional Test Scenarios (Cross-cutting)

| ID          | Level | Priority | Test                      | Justification              |
| ----------- | ----- | -------- | ------------------------- | -------------------------- |
| 2.1-E2E-002 | E2E   | P0       | End-to-end command flow   | Critical path + performance|

## Test Implementation Strategy

### Unit Tests (Priority P0-P1) - `tests/unit/test_main.py`

```python
# Framework Structure Tests
test_cli_group_creation()
test_argument_parsing_valid_formats()  
test_multiple_arguments_handling()
test_slash_stripping_logic()

# User Feedback Tests  
test_success_message_format()
test_message_command_context()
test_help_text_content()

# Edge Case Tests
test_empty_arguments_handling()
test_special_characters_in_arguments()
test_commands_without_slash()
test_color_formatting_validation()
```

### Integration Tests (Priority P0-P1) - `tests/integration/test_cli_integration.py`

```python
# Core Integration
test_clipboard_copy_success()
test_clipboard_failure_fallback()  
test_process_command_integration()
test_cli_entry_point_functionality()
```

### E2E Tests (Priority P0-P1) - `tests/e2e/test_cli_e2e.py`

```python
# Critical Paths
test_complete_command_execution_flow()
test_help_command_user_journey()
```

## Recommended Execution Order

1. **Phase 1 - P0 Unit Tests** (Fail Fast)
   - CLI framework structure
   - Argument parsing critical paths
   
2. **Phase 2 - P0 Integration Tests**
   - Clipboard functionality  
   - Core integration validation

3. **Phase 3 - P0 E2E Tests**
   - End-to-end command flow
   - Performance validation (<150ms)

4. **Phase 4 - P1 Tests** 
   - User feedback and help
   - Edge cases and robustness

5. **Phase 5 - P2 Tests** (Time Permitting)
   - Visual formatting validation

## Mock Strategy

### Unit Tests Mocking
- `pyperclip.copy()` - Mock for clipboard operations
- `process_command()` - Mock core module for CLI layer isolation
- `click.secho()` - Verify color parameter calls

### Integration Tests Mocking  
- Minimal mocking - Test real interactions
- Use test doubles for file system operations
- Mock external dependencies only

## Test Data Requirements

### Command Test Cases
```python
VALID_COMMANDS = [
    ('/example', ['arg1', 'arg2']),
    ('/test-command', []),
    ('/complex', ['arg with spaces', 'special!chars'])
]

EDGE_CASES = [
    ('example', ['arg1']),  # No slash
    ('', []),  # Empty command
    ('/test', ['arg1', '', 'arg3'])  # Empty argument
]
```

## Performance Criteria

- **P0 Requirement**: All CLI operations complete in <150ms
- **Test Method**: Time measurement in E2E test
- **Acceptance**: Average < 100ms, Max < 150ms over 10 executions

## Test Environment Setup

### Unit Tests
- No external dependencies
- Mock all I/O operations  
- Fast execution (<5 seconds total)

### Integration Tests
- Real pyperclip integration
- Test clipboard availability detection
- Cross-platform compatibility

### E2E Tests
- Full CLI environment
- Real command execution
- Performance timing measurement

## Coverage Expectations

| Test Level  | Target Coverage | Critical Focus                    |
| ----------- | --------------- | --------------------------------- |
| Unit        | >90%            | CLI logic, argument processing    |
| Integration | >80%            | Component interactions            |
| E2E         | 100% critical   | User journeys, performance        |

## Quality Gates Integration

### Must Pass for Deployment
- All P0 tests passing
- Performance requirements met (<150ms)
- Clipboard fallback mechanism validated
- Integration with core pipeline confirmed

### Warning Signals  
- P1 test failures (investigate but may proceed)
- Performance >120ms (monitor in production)

### Acceptable Risks
- P2 test failures (visual formatting)
- Minor edge case issues if well documented